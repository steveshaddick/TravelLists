function Location(t,e){this.name=t.name,this.id=t.id,this.listOrder=t.listOrder,this.lat=t.lat,this.lng=t.lng,this.isOpen=!0,this.wasOpen=!0,this.totalNotes=0,this.topOffset=this.bottomOffset=0,this.hash="",this.text=[],this.text.suggestCTA="",this.text.noteTextPlaceholder="",this.$element=null,this.$notesElement=null,this.$showHideButton=null,this.$noteText=null,this.$noteEditor=null,this.notes=[];var e=e===void 0?!1:e;this.$element=$("#clsLocation").clone(!0).attr("id","location_"+this.id),this.$element.html(this.$element.html().replace(/\$LOCATION\$/g,this.name).replace(/\$LOCATION_ID\$/g,this.id)),this.$element.attr("data-order",this.listOrder),this.hash=this.name.indexOf(",")>-1?this.name.substring(0,this.name.indexOf(",")):this.name,$(".anchor",this.$element).attr("id",this.hash),this.$noteText=$(".txtNoteText",this.$element),this.$noteEditor=$(".note-editor",this.$element),this.text.suggestCTA=$(".note-text-label",this.$element).html();var o=Math.floor(10*Math.random());switch(this.text.noteTextPlaceholder="ex. You've got to try the skybar!",o){case 0:this.text.noteTextPlaceholder="ex. There's a great hostel called Best Hostel Ever.";break;case 1:this.text.noteTextPlaceholder="ex. Go to Mindy's and order the soup.";break;case 2:this.text.noteTextPlaceholder="ex. Contemporary art gallery. Don't miss it."}this.$noteText.attr("placeholder",this.text.noteTextPlaceholder).focus({location:this},this.noteTextFocus),this.$showHideButton=$(".show-hide-link",this.$element),this.$showHideButton.click({location:this},this.showHide);var n=$("#locations > .location");if(0===n.length||e)$("#locations").append(this.$element);else{var i=this,a=!1;n.each(function(){a||$(this).attr("data-order")>i.listOrder&&($(this).before(i.$element),a=!0)}),a||$("#locations").append(this.$element)}this.$notesElement=$(".notes-wrapper",this.$element);for(var l=0,s=t.notes.length;s>l;l++)this.addNote(t.notes[l])}Location.prototype.destroy=function(){},Location.prototype.addNote=function(t,e){var o=$("#clsNote").clone().attr("id","note_"+t.id);e=e===void 0?!1:e,$noteDelete=$(".note-delete a",o),$noteDelete.attr("data-location",this.id).attr("data-note",t.id),t.canDelete&&$noteDelete.removeClass("edit-mode"),t.$element=o,this.notes[t.id]=t,t.linkCheck<=(new Date).valueOf()/1e3&&Main.queueLinkCheck(this,t.id,t.linkUrl),this.parseNote(t.id),this.$notesElement.append(o),this.isOpen&&e&&o.hide().show("slow"),this.$showHideButton.removeClass("hidden"),this.totalNotes++,this.expand(),t.id>GLOBAL.lastNote&&(GLOBAL.lastNote=t.id)},Location.prototype.parseNote=function(t,e){var o=this.notes[t];e!==void 0&&(o.linkTitle=e.linkTitle,o.linkImage=e.linkImage,o.linkDescription=e.linkDescription);var n,i=o.note;switch(""!=o.linkUrl?""!=o.linkImage||""!=o.linkDescription?($(".link-title",o.$element).attr("href",o.linkUrl).html(o.linkTitle),i==o.linkUrl?$(".note-text",o.$element).css("display","none"):$(".note-text",o.$element).css("display",""),$(".note-link",o.$element).css("display",""),""!=o.linkImage?$(".link-image",o.$element).attr("src",o.linkImage).parent().attr("href",o.linkUrl):$(".link-image",o.$element).addClass("hidden"),""!=o.linkDescription&&$(".link-description",o.$element).html(o.linkDescription)):$(".note-link",o.$element).css("display","none"):$(".note-link",o.$element).css("display","none"),n=/(\(?\bhttps?:\/\/[-A-Za-z0-9+&@#\/%?=~_()|!:,.;]*[-A-Za-z0-9+&@#\/%=~_()|])/g,i=i.replace(n,'<a target="_blank" href="$1">$1</a>').replace(/href="\(/g,'href="').replace(/\)">/g,'">'),o.categoryId){case"1":$(".note-category",o.$element).addClass("stay");break;case"2":$(".note-category",o.$element).addClass("food");break;case"3":$(".note-category",o.$element).addClass("poi")}""==o.fromName&&(o.fromName="Anonymous"),$(".note-text",o.$element).html(i),$(".note-from",o.$element).html("-"+o.fromName)},Location.prototype.deleteNote=function(t){var e=this.notes[t],o=this;return void 0!==t&&(e.canDelete||GLOBAL.isEditMode)?(Ajax.call("deleteNote",{noteId:t,noteCookie:GLOBAL.noteCookie},function(){$("#note_"+t).remove(),delete o.notes[t],this.totalNotes--},function(){}),!1):void 0},Location.prototype.showHide=function(t){var e=t.data.location;return e.isOpen?e.collapse():e.expand(),!1},Location.prototype.collapse=function(){this.cancelNote(),$(".notes-hidden .number",this.$element).html(this.totalNotes),$(".notes-wrapper",this.$element).slideUp(),$(".notes-hidden",this.$element).show(),this.isOpen=!1,this.$showHideButton.html("+").attr("title","Expand")},Location.prototype.expand=function(){$(".notes-wrapper",this.$element).slideDown(),$(".notes-hidden",this.$element).hide(),this.isOpen=!0,this.$showHideButton.html("&#150;").attr("title","Collapse")},Location.prototype.forceCollapse=function(){this.wasOpen=this.isOpen,this.collapse()},Location.prototype.reExpand=function(){this.wasOpen&&this.expand()},Location.prototype.noteTextFocus=function(t){var e=t.data.location;GLOBAL.activeNoteLocation!==e&&(GLOBAL.activeNoteLocation&&GLOBAL.activeNoteLocation.cancelNote(),e.editNote())},Location.prototype.noteTextBlur=function(){},Location.prototype.editNote=function(){var t=this;GLOBAL.activeNoteLocation=this,$(".note-text-label",this.$element).addClass("hidden"),this.$noteText.attr("placeholder","").addClass("editing"),this.$noteText.keyup(function(e){return 27==e.which?(t.cancelNote(),void 0):(13==e.which&&(""==$("#txtFromName").val()?$("#txtFromName").focus():t.submitNote()),void 0)}),$(".category-wrapper",this.$element).append($("#clsCategorySelector")),$(".note-editor-bottom",this.$element).append($("#clsNoteFrom")).append($("#clsSubmitNote")),$("#txtFromName").keyup(function(e){return 27==e.which?(t.cancelNote(),void 0):(13==e.which&&t.submitNote(),void 0)}),$("#submitNoteButton").click(function(){return t.submitNote(),!1}),$("#cancelNoteButton").click(function(){return t.cancelNote(),!1})},Location.prototype.cancelNote=function(){GLOBAL.activeNoteLocation=null,this.$noteEditor.off("focusout"),$(".note-text-label",this.$element).removeClass("hidden"),this.$noteText.attr("placeholder",this.text.noteTextPlaceholder).removeClass("editing").unbind("keyup").val("").blur(),$("#cls").append($("#clsCategorySelector")).append($("#clsNoteFrom")).append($("#clsSubmitNote")),$("#txtFromName").unbind("keyup"),$("#submitNoteButton").unbind("click"),$("#cancelNoteButton").unbind("click")},Location.prototype.submitNote=function(){var t=$.trim(this.$noteText.val()),e=($("#selCategory").val(),$.trim($("#txtFromName").val()));if(""==t)return this.cancelNote(),void 0;if(""==e&&(e="Anonymous"),$.cookie("from",e,{expires:365,path:"/"}),!GLOBAL.noteCookie){GLOBAL.noteCookie="";for(var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;10>n;n++)GLOBAL.noteCookie+=o.charAt(Math.floor(Math.random()*o.length));GLOBAL.noteCookie+=(new Date).valueOf()}return $(".blocker",this.$noteEditor).removeClass("hidden"),$(".category-wrapper",this.$noteEditor).addClass("invisible"),$(".note-text-wrapper",this.$noteEditor).addClass("invisible"),$(".note-editor-bottom",this.$noteEditor).addClass("invisible"),void 0};var Trip=function(){function t(t){$("body select").msDropDown(),Ajax.call("loadTrip",{},function(t){for(var i=0,a=t.locations.length;a>i;i++)a-1>i?n(t.locations[i],!0):n(t.locations[i]);L=t.tripName,x=t.tripAuthor,b=t.email,$("#editTripButton").click(c),$(document).on("click",".note-delete>a",e),Main.poll(),o(),setTimeout(function(){$("#loadingTrip").slideUp()},500)},function(){}),h=new google.maps.LatLngBounds;var i={center:new google.maps.LatLng(t.lat,t.lng),zoom:4,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,scrollwheel:!1,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL}};p=new google.maps.Map(document.getElementById("map"),i),$.cookie("from")&&$("#txtFromName").val($.cookie("from")),f=$("#stickyLocation"),m=$(document),$(window).scroll(o)}function e(t){var e=$(t.currentTarget),o=e.attr("data-location"),n=e.attr("data-note");return v[o].location.deleteNote(n),!1}function o(){if(g)return C=!0,void 0;var t=m.scrollTop(),e="";for(var n in v){if(t>v[n].location.$element.offset().top+50&&v[n].location.$element.offset().top+v[n].location.$element.height()-200>t){e=v[n].location.name;break}e=""}e!=y&&(y=e,""!=e?(f.css("top",0),$(".location-name",f).html(e).attr("href","#"+v[n].location.hash)):f.css("top","")),C=!1,g=!0,setTimeout(function(){g=!1,C&&o()},50)}function n(t,e){var o=new Location(t),n=null;if(0!=o.lat&&0!=o.lng){var i={animation:google.maps.Animation.DROP,position:new google.maps.LatLng(o.lat,o.lng),title:o.name};n=new google.maps.Marker(i),google.maps.event.addListener(n,"click",function(){var t=o.$element.offset().top;$("html, body").animate({scrollTop:t},500)}),n.setMap(p),h.extend(i.position)}v[o.id]={location:o,marker:n},k++,t.id>GLOBAL.lastLocation&&(GLOBAL.lastLocation=t.id),e===void 0&&(k>1?p.fitBounds(h):p.setCenter(i.position))}function i(t,e){v[t.locationId]!==void 0&&v[t.locationId].location.addNote(t,e)}function a(t){var e,o=0;for(e in v[t].location.notes){v[t].location.notes.hasOwnProperty(e)&&o++;break}return o>0&&!confirm('"'+v[t].location.name+'" has notes in it, are you sure you want to delete it?')?!1:(Ajax.call("deleteLocation",{locationId:t},function(){l(t)},function(){}),void 0)}function l(t){if($("#location_"+t).remove(),v[t].marker&&v[t].marker.setMap(null),v[t].location.destroy(),v.splice(t,1),k--,k>1){h=new google.maps.LatLngBounds;for(var e in v)v[e].marker&&(h.extend(v[e].marker.getPosition()),p.fitBounds(h))}}function s(t,e){var o=$("#location_"+t),n=parseInt(o.attr("data-order")),i=e?n-1:n+1;if(!(1>i||i>k)){var a=$(".location").filter(function(){return $.attr(this,"data-order")==i});Ajax.call("reorderLocation",{currentLocation:t,swapLocation:a.attr("id").replace("location_",""),newOrder:i,swapOrder:n},function(){a.attr("data-order",n),o.attr("data-order",i),e?a.before(o):a.after(o)},function(){})}}function r(){return{tripName:L,tripAuthor:x}}function c(){return EditModeModal.open(),!1}function d(){for(var t in v)v[t].location.forceCollapse()}function u(){for(var t in v)v[t].location.reExpand()}var p,h,m,f,v=[],k=0,L="",x="",b="",g=!1,C=!0,y="";return{loadTrip:t,addLocation:n,addNote:i,deleteLocation:a,reorderLocation:s,getTripInfo:r,forceCollapseNotes:d,reExpandNotes:u}}(),EditModeModal=function(){function t(){Modal.load("/views/modal/enterEmail.html",n,"email-modal")}function e(t){var e=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return e.test(t)}function o(){var t=!0;""==$.trim(r.val())&&(t=!1),r.hasClass("error")&&(r.removeClass("error"),$("#errorReturn").addClass("hidden")),t?c.removeClass("hidden"):c.addClass("hidden")}function n(){return u?(EditMode.init(),Modal.close(),void 0):(c=$("#emailAdmin"),r=$("#txtEmail"),d=!1,r.keyup(o).focus(),c.click(i),$("#isRemember").click(a),$(document).keyup(l),$("#oopsLink").click(s),$.cookie("email")?($("#isRemember").prop("checked",!0),r.val($.cookie("email"))):c.focus(),o(),void 0)}function i(){if(!d){var t=r.val();return e(t)?(d=!0,$("#isRemember").is(":checked")&&$.cookie("email",t,{expires:365,path:"/"}),Ajax.call("checkEditMode",{email:t},function(){EditMode.init(),$.cookie("email")&&(u=!0),s()},function(){r.addClass("error"),$("#errorReturn").removeClass("hidden"),d=!1,u=!1}),!1):(r.addClass("error"),void 0)}}function a(){$("#isRemember").is(":checked")||$.removeCookie("email",{path:"/"})}function l(t){switch(t.which){case 13:i()}}function s(){return r.unbind("keyup",o),c.unbind("click",i),$("#isRemember").unbind("click",a),$(document).unbind("keyup",l),c=null,r=null,d=!1,Modal.close(),!1}var r,c,d=!1,u=!1;return{open:t,close:s}}(),EditMode=function(){function t(){$(".edit-mode").removeClass("edit-off"),GLOBAL.activeNoteLocation&&GLOBAL.activeNoteLocation.cancelNote(),$(".edit-hidden").addClass("hidden"),$("header").addClass("edit-on"),$("#map").addClass("edit-on"),$("#addLocationButton").click(o),$(document).on("click",".delete-location-button",a).on("click",".location-up",l).on("click",".location-down",l),$("#editDoneButton").click(e),r=new EditText($("#tripTitle"),function(){s({tripTitle:$("#tripTitle").html()})}),c=new EditText($("#tripSubtitle"),function(){s({tripSubtitle:$("#tripSubtitle").html()})}),$("#editBar").slideDown(),Trip.forceCollapseNotes(),GLOBAL.isEditMode=!0}function e(){return GLOBAL.isEditMode=!1,Ajax.call("closeEditMode"),$(".edit-mode").addClass("edit-off"),$(".edit-hidden").removeClass("hidden"),$("header").removeClass("edit-on"),$("#map").removeClass("edit-on"),$("#addLocationButton").unbind("click"),$(document).off("click",".delete-location-button",a).off("click",".location-up",l).off("click",".location-down",l),$("#editDoneButton").unbind("click"),r.destroy(),c.destroy(),$("#editBar").slideUp(),Trip.reExpandNotes(),!1}function o(){return $("html, body").scrollTop(0),Modal.load("/views/modal/addLocation.html",function(){var t={types:["(regions)"]};d=new google.maps.places.Autocomplete(document.getElementById("txtLocation"),t),Modal.jQ(".submit-location-link").click(n),Modal.jQ(".cancel-link").click(i),$("#txtLocation").select().keypress(function(t){var e=t.keyCode?t.keyCode:t.which;switch(e){case 13:n()}})},"location-modal"),!1}function n(){var t=$("#txtLocation").val();if(""!=t)return $("#txtLocation").prop("disabled",!0),Ajax.call("addLocation",{location:t},function(t){i(),Trip.addLocation(t)},function(){$("#txtLocation").val(""),$("#txtLocation").prop("disabled",!1)}),!1}function i(){return d=null,$("#txtLocation").unbind("keypress"),Modal.jQ(".submit-location-link").unbind("click"),Modal.jQ(".cancel-link").unbind("click"),Modal.close(),!1}function a(){var t=$(this).attr("data-id");return Trip.deleteLocation(t),!1}function l(t){var e=$(this).attr("data-id");return Trip.reorderLocation(e,$(t.target).hasClass("location-up")?!0:!1),!1}function s(t){Ajax.call("saveTrip",t)}var r,c,d=null;return{init:t,dinit:e}}(),EditText=function(t,e){this.$element=t,this.saveCallback=e,this.$divWrapper=$('<div class="edit-text"><input type="text" disabled="disabled" class="editTextInput" /></div>'),this.$divWrapper.addClass(this.$element.attr("class")),this.$input=$(".editTextInput",this.$divWrapper).css("display","none"),this.$element.after(this.$divWrapper),this.$divWrapper.append(this.$element),this.$input.val(this.$element.html()),this.$divWrapper.click({editText:this},this.onClickHandler)};EditText.prototype.onClickHandler=function(t){var e=t.data.editText;e.$input.css("display","").prop("disabled",!1).attr("class","editTextInput "+e.$element.attr("class")),e.$element.css("display","none"),e.$divWrapper.unbind("click"),e.$input.select().blur({editText:e},e.finishText).keypress({editText:e},e.onKeypress)},EditText.prototype.onKeypress=function(t){var e=t.keyCode?t.keyCode:t.which,o=t.data.editText;switch(e){case 13:o.finishText(t);break;case 27:o.$input.val(o.$element.html()),t.data.noSave=!0,o.finishText(t)}},EditText.prototype.finishText=function(t){var e=t.data.editText;e.$input.prop("disabled",!0).unbind("blur").unbind("keypress").css("display","none"),e.$element.css("display","").html(e.$input.val()),e.$divWrapper.click({editText:e},e.onClickHandler),t.data.noSave===void 0&&e.saveCallback(e.$element)},EditText.prototype.destroy=function(){this.$divWrapper.unbind("click"),this.$divWrapper.before(this.$element),this.$divWrapper.remove(),this.$divWrapper=null,this.$input.remove(),this.$input=null,this.$element=null,this.saveCallback=null};var Home=function(){function t(t){switch($(".next-button").click(d),$(".back-button").click(c),$(".create-button").click(d),t){case"lost":L=$("#lostTripPage"),x=$("#sentEmailPage"),b=L,s();break;default:v=$("#infoPage"),k=$("#locationPage"),b=k,a()}$(document).keydown(function(t){switch(t.which){case 13:d()}})}function e(t){var e=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return e.test(t)}function o(){for(var t=!0,e=0,o=g.length;o>e;e++)""==$.trim(g[e].val())&&(t=!1),g[e].hasClass("error")&&g[e].removeClass("error");t?f.removeClass("hidden"):f.addClass("hidden")}function n(){C=!1,g=[$("#txtName"),$("#txtEmail")],g[0].prop("disabled",!1).keyup(o).focus(),g[1].prop("disabled",!1).keyup(o),f=$(".next-button",v),$(".back-button",v).removeClass("hidden"),o()}function i(){g[0].prop("disabled",!0).unbind("keyup"),g[1].prop("disabled",!0).unbind("keyup"),g[0].val($.trim(g[0].val())),g[1].val($.trim(g[1].val())),f.addClass("hidden"),$(".back-button",v).addClass("hidden")}function a(){C=!1,g=[$("#txtLocation")],g[0].prop("disabled",!1).keyup(o).focus(),f=$(".next-button",k),o();var t={types:["(regions)"]};new google.maps.places.Autocomplete(g[0][0],t)}function l(){g[0].prop("disabled",!0).unbind("keyup"),f.addClass("hidden")}function s(){C=!1,g=[$("#txtEmail")],g[0].prop("disabled",!1).keyup(o).focus(),f=$(".next-button",L)}function r(){g[0].val($.trim(g[0].val())),g[0].prop("disabled",!0).unbind("keyup")}function c(){if(!C){C=!0;var t;switch(b.removeClass("page-current").addClass("page-right"),b){case v:i(),b=k,t=a}return b.removeClass("page-left").addClass("page-current"),TransitionController.transitionEnd(b,t),!1}}function d(){if(!C){if(!f.hasClass("hidden")){var t;switch(b){case v:if(!e(g[1].val()))return g[1].addClass("error"),void 0;C=!0,b.removeClass("page-current").addClass("page-left"),i(),$(".trip-subtitle").html("by "+g[0].val()),$(".email").html(g[1].val()),u();break;case k:C=!0,b.removeClass("page-current").addClass("page-left"),l(),$(".trip-title").html(g[0].val()),b=v,t=n;break;case L:if(!e(g[0].val()))return g[0].addClass("error"),void 0;p()}return b.removeClass("page-right").addClass("page-current"),TransitionController.transitionEnd(b,t),!1}if(g&&g.length>1)for(var o=0,a=g.length-1;a>o;o++)if(g[o].is(":focus")){g[o+1].focus();break}}}function u(){var t=$("#txtName").val(),e=$("#txtEmail").val(),o=$("#txtTripName").val(),n=$("#txtLocation").val();Main.loadBlock(),Ajax.call("createTrip",{name:t,email:e,tripName:o,location:n},h)}function p(){var t=$("#txtEmail").val();return e(t)?(Main.loadBlock(),$("#txtEmail").prop("disabled",!0),Ajax.call("sendEmail",{adminEmail:t},m),void 0):($("#txtEmail").addClass("error"),void 0)}function h(t){t.success?window.location="/"+t.tripHash:alert("ERROR!")}function m(t){return Main.loadRelease(),$("#txtEmail").prop("disabled",!1),""!==!t.message?(alert(t.message),void 0):(C=!0,b.removeClass("page-current").addClass("page-left"),r(),b=x,b.removeClass("page-right").addClass("page-current"),void 0)}var f=null,v=null,k=null,L=null,x=null,b=null,g=[],C=!1;return{init:t}}();"undefined"==typeof console&&(console={log:function(){}});var GLOBAL={isEditMode:!1,polltime:15e3,lastLocation:0,lastNote:0,lastNotice:0,activeNoteLocation:null,noteCookie:!1},Notice=function(){function t(t,o){o=o===void 0?!1:o,a.unshift(t),t._id>GLOBAL.lastNotice&&(GLOBAL.lastNotice=t._id),o||e()}function e(){l||(s=$("#noticeContainer"),s.css("display","block"),l=$(".notice",s),r=s.offset().top,c=$(document),$(window).scroll(n)),n(),l.removeClass("down").addClass("up"),$(".notice-text",l).html(a[0].notice),$(".delete-link",l).unbind("click"),setTimeout(function(){l.removeClass("up"),TransitionController.transitionEnd(l,function(){$(".delete-link",l).bind("click",o)})},1)}function o(){$(".delete-link",l).unbind("click"),l.removeClass("up").addClass("down"),TransitionController.transitionEnd(l,function(){i()}),Ajax.call("deleteNotice",{noticeId:a[0]._id},null,null,!0)}function n(){d||(c.scrollTop()>=r?s.addClass("fixed"):s.removeClass("fixed"),d=!0,setTimeout(function(){d=!1},50))}function i(){a.shift(),a.length>0?e():(s.css("display","none"),l=null,s=null,$(window).unbind("scroll",n))}var a=[],l=null,s=null,r=0,c=null,d=!1;return{addNotice:t}}(),Settings=function(){function t(){$("txtTripName").val()}function e(){o?t():close()}var o=!1;return{toggleSettings:e}}(),Main=function(){function t(t){Ajax.init(t.a),GLOBAL.noteCookie=t.noteCookie,$("#shareTripButton").click(r)}function e(){$("#loadBlocker").css("display","block")}function o(){$("#loadBlocker").css("display","none")}function n(t,e,o){""!=o&&(c.push({location:t,noteId:e,url:o}),i())}function i(){if(0!=c.length){var t=c[0];Ajax.call("checkLink",{noteId:t.noteId,url:t.url},function(e){t.location.parseNote(t.noteId,e),i()},function(){i()},!0),c.shift()}}function a(){setTimeout(l,GLOBAL.polltime)}function l(){Ajax.call("poll",{lastLocation:GLOBAL.lastLocation,lastNote:GLOBAL.lastNote,lastNotice:GLOBAL.lastNotice,polltime:GLOBAL.polltime},s,s,!0)}function s(t){if(t&&t.success){GLOBAL.polltime=t.polltime?t.polltime:GLOBAL.polltime;var e;for(e=0;t.locations.length>e;e++)Trip.addLocation(t.locations[e]);for(e=0;t.notes.length>e;e++)Trip.addNote(t.notes[e],!0);if(GLOBAL.isAdmin)for(e=0;t.notices.length>e;e++)Notice.addNotice(t.notices[e])}a()}function r(){return Modal.load("/views/modal/shareTrip.html",function(){$(".text-box",$("#modalContent")).val("http://"+window.location.hostname+window.location.pathname).select(),$("#doneButton").click(function(){return $("#doneButton").unbind("click"),Modal.close(),!1})},"share-modal"),!1}var c=[];return{init:t,loadBlock:e,loadRelease:o,queueLinkCheck:n,poll:a}}();